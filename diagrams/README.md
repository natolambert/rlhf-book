# Diagram Sources for RLHF Book

This directory contains source files for generating diagrams. These are **mockups** intended for iteration with coding tools, to be refined by a professional artist.

## Directory Structure

```
diagrams/
├── specs/          # YAML specifications for each diagram type
├── scripts/        # Python scripts for generating diagrams
├── tikz/           # TikZ/LaTeX diagram sources
├── generated/      # Intermediate outputs (SVG, PNG before final placement)
└── README.md       # This file
```

## Workflow

1. **Edit specs** in `specs/` to define the conceptual content
2. **Generate diagrams** using `make all`
3. **Review outputs** in `generated/`
4. **Copy final versions** to `images/` for use in the book
5. **Commit both sources and outputs** for reproducibility

## Tooling Requirements

### Python + matplotlib

Dependencies are managed via uv:
```bash
uv add matplotlib  # if not already installed
```

### TikZ/LaTeX (for tikz/ diagrams)

Requires a TeX distribution with pdflatex:
```bash
# macOS (BasicTeX or full TeX Live)
brew install --cask basictex

# Compile TikZ diagrams
make tikz
```

## Generating All Diagrams

```bash
# From diagrams directory
make all

# Or specific targets
make tokens  # Token strip diagrams
make grpo    # PPO vs GRPO architecture diagram (matplotlib)
make tikz    # PPO vs GRPO vs RLOO diagram (TikZ/LaTeX)

# See all targets
make help
```

## Diagram Types

### 1. Token Strip Visualizations
Horizontal token sequences showing where supervision attaches:

- **Preference RM**: highlight EOS/last token only (chosen vs rejected)
- **ORM**: highlight all completion tokens (prompt masked)
- **PRM**: highlight step boundary tokens only (3-class labels)
- **Value function**: highlight all tokens (state values)

Generated by:
- `scripts/generate_token_strips.py` - Simple strips
- `scripts/generate_multilane_strips.py` - Multi-lane with targets/usage

### 2. Architecture Comparison Diagrams
Box-and-arrow flows showing model architectures:

- **PPO vs GRPO vs RLOO**: Compares three policy gradient algorithms for RLHF
  - **PPO**: Single output, value network, GAE for per-token advantages, KL in reward
  - **GRPO**: Group of G outputs, group normalization for advantages, KL as loss term
  - **RLOO**: Group of K outputs, leave-one-out baseline, KL folded into reward

Generated by:
- `scripts/generate_ppo_grpo.py` (matplotlib version)
- `tikz/ppo_grpo_tikz.tex` (TikZ/LaTeX version - preferred for print)

## Handoff to Artist

When ready for professional refinement:

1. Export all diagrams as SVG
2. Provide the YAML specs as semantic documentation
3. Include a style guide (fonts, colors, stroke widths)
4. Use consistent naming: `fig_rm_{type}_{variant}.svg`
